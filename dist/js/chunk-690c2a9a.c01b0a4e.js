(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-690c2a9a"],{"096b":function(t,i,n){"use strict";n.d(i,"a",(function(){return a})),n.d(i,"b",(function(){return e})),n.d(i,"c",(function(){return s}));var o=n("a358"),r=o["a"],a=function(t){return r({method:"post",url:"/cgi-bin/v1/yan/synth/modify_audio_draft",data:t})},e=function(t){return r({method:"post",url:"/cgi-bin/v1/yan/synth/del_audio_draft",data:{draft_id:t}})},s=function(t){return r({method:"post",url:"/cgi-bin/v1/yan/synth/get_audio_draft_detail",data:{draft_id:t}})}},"4ec3":function(t,i,n){"use strict";n.d(i,"c",(function(){return a})),n.d(i,"a",(function(){return e})),n.d(i,"d",(function(){return s})),n.d(i,"e",(function(){return c})),n.d(i,"b",(function(){return u})),n.d(i,"f",(function(){return d}));var o=n("a358"),r=o["a"],a=function(t){return r({method:"get",url:"/cgi-bin/musicx/kuwa/search_music",params:t})},e=function(t){return r({method:"get",url:"/cgi-bin/musicx/kuwa/get_music_edit_detail",params:{arrange_id:t}})},s=function(t){return r({method:"get",url:"/cgi-bin/musicx/kuwa/get_music_info",params:{music_id:t}})},c=function(t){return r({method:"get",url:"/cgi-bin/musicx/kuwa/get_music_ext_info",params:{music_id:t}})},u=function(t){return r({method:"post",url:"/cgi-bin/musicx/kuwa/pre_arrange_music",data:t})},d=function(t){return r({method:"post",url:"/cgi-bin/musicx/kuwa/arrange_music",data:t})}},"7db0":function(t,i,n){"use strict";var o=n("23e7"),r=n("b727").find,a=n("44d2"),e="find",s=!0;e in[]&&Array(1)[e]((function(){s=!1})),o({target:"Array",proto:!0,forced:s},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),a(e)},"7fee":function(t,i,n){},af83:function(t,i,n){"use strict";n.r(i);var o=function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("div",{staticClass:"re-edit-page"},[t._m(0),n("div",{staticClass:"tips"},[t._v("您的歌词中含有多音字（标红显示），请确保下面每个字对应的拼音是正确的")]),n("div",{staticClass:"lyric"},t._l(t.lyricList,(function(i,o){return n("div",{key:i.content+o,staticClass:"item"},t._l(Array.from(i.content),(function(i,r){return n("span",{key:i+r},[n("span",{class:t.polyphonicMap[o]&&t.polyphonicMap[o][r]?"strong":""},[t._v(t._s(i))]),t.polyphonicMap[o]&&t.polyphonicMap[o][r]?n("span",{staticClass:"pinyin-selector-box"},[n("span",{staticClass:"bracket"},[t._v("[")]),t._l(t.polyphonicMap[o][r].options,(function(a){return n("span",{key:a+r,class:t.polyphonicMap[o][r].model===a?"selected":""},[n("span",{staticClass:"radio-icon",on:{click:function(i){return t.radioClick(o,r,a)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.polyphonicMap[o][r].model,expression:"polyphonicMap[lineIndex][charIndex].model"}],attrs:{type:"radio",name:i+o+r,hidden:""},domProps:{value:a,checked:t._q(t.polyphonicMap[o][r].model,a)},on:{change:[function(i){return t.$set(t.polyphonicMap[o][r],"model",a)},t.radioChange]}}),n("span",{staticClass:"pinyin",on:{click:function(i){return t.radioClick(o,r,a)}}},[t._v(t._s(a))])])})),n("span",{staticClass:"bracket"},[t._v("]")])],2):t._e()])})),0)})),0),n("div",{staticClass:"footer"},[n("button",{staticClass:"main-button",on:{click:t.prevButtonClick}},[t._v("上一步")]),n("button",{staticClass:"main-button",on:{click:t.audioButtonClick}},[t._v("去调音")]),n("button",{staticClass:"main-button",on:{click:t.confirmButtonClick}},[t._v("生成音频")])])])},r=[function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("div",{staticClass:"page-title"},[o("img",{staticClass:"step",attrs:{src:n("c2e4"),alt:""}}),o("div",{staticClass:"text"},[t._v("校正歌词")])])}],a=(n("159b"),n("7db0"),n("4de4"),n("d81d"),n("99af"),n("4ec3")),e=n("096b"),s=n("3dc7"),c=n("b233"),u={name:"Home",components:{Header:s["a"]},data:function(){return{submitSuccess:!1,oldForm:{},lyricList:[],polyphonicList:[],polyphonicMap:{},wantAddDraft:!0}},created:function(){var t=sessionStorage.getItem("draftId");t?this.getDraftInfo(t):this.getDefaultInfo()},mounted:function(){var t=this;Object(c["m"])("edit-page-2-exposure"),window.onbeforeunload=function(i){var n=t.comparisonFormData();if(!0===n&&t.wantAddDraft)return t.submitDraft(),"您可能有数据没有保存"}},destroyed:function(){window.onbeforeunload=null},methods:{getDefaultInfo:function(){this.oldForm=JSON.parse(sessionStorage.getItem("form")),console.log("getDefaultInfo this.oldForm:",this.oldForm),this.polyphonicList=JSON.parse(sessionStorage.getItem("polyphonicList")),this.initFormData()},getDraftInfo:function(t){var i=this;Object(e["c"])(t).then((function(t){var n=t.data.data,o=n.audio_draft_info.content;return o.arrange_id=i.$route.query.arrangeId||void 0,i.oldForm=o,Object(a["b"])(o)})).then((function(t){var n=t.data.data;i.polyphonicList=n.polyphonic_list,console.log("fetchDraftDetailById this.polyphonicList:",i.polyphonicList),i.initFormData()}))},initFormData:function(){this.lyricList=this.oldForm.new_lyric_list,this.initPolyphonicMap(),this.defaultForm=this.getFormData()},initPolyphonicMap:function(){var t=this;this.polyphonicList.forEach((function(i){var n=i.x,o=i.y,r=i.pinyin_list;t.polyphonicMap[n]||(t.polyphonicMap[n]={}),t.polyphonicMap[n][o]={options:r},t.oldForm.fix_pinyin_list&&0!==t.oldForm.fix_pinyin_list.length?t.polyphonicMap[n][o].model=t.oldForm.fix_pinyin_list.filter((function(t){return t.x===n})).find((function(t){return t.y===o})).pinyin||"":t.polyphonicMap[n][o].model=r[0]}))},deleteDraft:function(){var t=sessionStorage.getItem("draftId");Object(e["b"])(t),sessionStorage.setItem("draftId","")},getFormData:function(){var t=this,i=this.polyphonicList.map((function(i){var n=i.x,o=i.y;if(t.polyphonicMap[n][o]){var r="";t.polyphonicMap[n][o].model&&(r=t.polyphonicMap[n][o].model);var a={x:n,y:o,pinyin:r};return a}}));return JSON.stringify(i)},comparisonFormData:function(){var t=this.defaultForm,i=this.getFormData(),n=!1;return t!==i&&(n=!0),n},submitDraft:function(){var t=this.oldForm,i=sessionStorage.getItem("draftId"),n=Object.assign({},t,{step:2,draft_id:i||"",fix_pinyin_list:JSON.parse(this.getFormData())});console.log("submitDraft f:",n),Object(e["a"])(n).then((function(t){var i=t.data.data,n=i.draft_id;sessionStorage.setItem("draftId",n)}))},radioClick:function(t,i,n){this.polyphonicMap[t][i].model=n,this.$forceUpdate()},radioChange:function(){Object(c["m"])("edit-page-2-polyphoic-update"),this.$forceUpdate()},prevButtonClick:function(){Object(c["m"])("edit-page-2-prev-button");var t=sessionStorage.getItem("editPath");console.log("editPath:",t),t?this.$router.push(JSON.parse(t)):this.$router.push("/edit/"+this.oldForm.music_id)},audioButtonClick:function(){this.wantAddDraft=!1;var t=JSON.parse(sessionStorage.getItem("form"));t.fix_pinyin_list=JSON.parse(this.getFormData()),t.is_add_ac=0,this.$route.query.arrangeId?(t.arrange_id=this.$route.query.arrangeId,this.$router.push("/audioEditor?musicId=".concat(t.music_id,"&index=1&arrangeId=").concat(this.$route.query.arrangeId))):this.$router.push("/audioEditor?musicId=".concat(t.music_id,"&index=1")),sessionStorage.setItem("xml2JsonReq",JSON.stringify(t)),this.deleteDraft()},confirmButtonClick:function(){var t=this;Object(c["m"])("edit-page-2-confirm-button");var i=this.oldForm;i.fix_pinyin_list=JSON.parse(this.getFormData()),log("rectify confirmButtonClick 提交数据：",i),Object(a["f"])(i).then((function(i){var n=i.data,o=(n.data,n.ret_code);0===o?(t.deleteDraft(),t.submitSuccess=!0,t.$router.push("/profile")):Message.error(i.data.err_msg)}))}}},d=u,l=(n("f134"),n("2877")),p=Object(l["a"])(d,o,r,!1,null,"2c6073ff",null);i["default"]=p.exports},c2e4:function(t,i){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAsCAMAAAAtr3oOAAAAkFBMVEUAAAAurv8srP9Dxf8sq/8sq/8tq/8srP8srP8urf8trP8ytv8trf8urf8wrv9M4/8srP8tq/8sq/8srP8srP8srP8srP8trP8trP8srP8trP8trP8srP8tq/8srf8srP8trf8xsv8ys/8srP8srP8srP8srP8sq/8trP8urP8trv8srP8vrP8srP8trv8sq/+7WJ8cAAAAL3RSTlMAK+0H+/Pl2r1WTwxlQRcD9+nW0babl3h04M2wp4+JbFsbE8jCraKVcUUygzncXwCFx2UAAAGqSURBVEjHjZXZkoIwEEUju+wgiyACiqC45f//bmrSpMAkaM7b3JzqGrvbFs088ySONN2ID7kXoO+orokXGA//m303MYPyXrddDfOkqzYWkoltm76Hl7TOkjikf9si2zHgMWocCM43HZJCFehHeOsWvdjoq+UdeCrOy7ABfeD1Fl62nyk01uT1HubCpFeS6rwOda5MmmOCyk0fJuQy8R5Gy3/SLcEXtqtEkuyIXknaHiZ4cvapIPZFzrYNaOP9R1HPG233+pp2iLP57s1YGySvH54QSeqxq8rqgNL80scsS6ukwBOpKtf1XAHfCpAU/gX8B5LDgZ0JfUl/hPI3JEkE7WfjDeHE6QnRd2wM29Rzegr3gY2tla/NIK6ekVhz2BxambDxGxNaJj5r4qvqhHCAmIHXa1evx4JD40HxkP6Pah3r5f5/J54YOAazbStTRu1y3qFh8ruRjqKiO0zP7APPQ/YjPGFUdV4PL0zZzlcHsEg1BTOwC6PTevC7FwnkEL5NTHXocsXZ5Ya/x/Ph9XptKVufDQ8sbj/99tiZiqaYXdpyCxo0SXxoEfoD0FNwFFuW6YUAAAAASUVORK5CYII="},f134:function(t,i,n){"use strict";n("7fee")}}]);